@page

@using Microsoft.AspNetCore.Identity
@using Project.Models

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<header class="bg-dark py-5">
    <div class="container px-4 px-lg-5 my-5">
        <div class="text-center text-white">
            <h1 class="display-4 fw-bolder">Shop in style</h1>
            <p class="lead fw-normal text-white-50 mb-0">With insane discount</p>
        </div>
    </div>
</header>

<section class="py-5">
    <div class="container px-4 px-lg-5 mt-5">
        <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
            @{
                @foreach (var product in Model.Products)
                {
                    <div class="col mb-5">
                        <div class="card h-100">
                            <div class="position-relative">
                            @if (product.ImageUri != null && product.ImageUri.Length != 0)
                            {
                                <img class="card-img-top" src="@product.ImageUri" width="300" height="165" alt="..." />
                            } 
                            else 
                            {
                                <img class="card-img-top" src="https://dummyimage.com/450x300/dee2e6/6c757d.jpg" 
                                width="300"
                                height="165"
                                alt="..." />
                            }
                            @if (product.QtyInStock == 0)
                            {
                                <div class="card-badge badge rounded-pill text-bg-dark">Sold Out</div>
                            }
                            </div>
                            
                            <div class="card-body p-4">
                                <div class="text-center">
                                    <h5 class="fw-bolder">@product.Name</h5>
                                    $@product.UnitPrice
                                </div>
                            </div>
                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                                <div class="text-center" x-data>
                                    @if (SignInManager.IsSignedIn(User))
                                    {
                                        <form method="post">
                                            <input type="hidden" name="productId" value="@product.Id" />
                                            @if (product.QtyInStock != 0)
                                            {
                                                <button class="btn btn-outline-dark mt-auto">
                                                    Add to Cart
                                                </button>
                                            }
                                            else
                                            {
                                                <button class="btn btn-outline-dark mt-auto" disabled>Add to Cart</button>
                                            }
                                        </form>
                                    }
                                    else
                                    {
                                        <a class="btn btn-outline-dark mt-auto" asp-area="Identity" asp-page="/Account/Login">Add to Cart</a>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</section>

<style scoped>
    #signin-container {
        padding: 0 300px;
        height: 70dvh;
    }

    .card-badge {
        display: block;
        position: absolute;
        left: 0.25rem;
        bottom: 0.25rem;
    }

    .flex-grow-4 {
        flex-grow: 4;
    }
</style>


